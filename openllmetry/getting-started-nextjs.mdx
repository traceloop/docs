---
title: "Next.js"
description: "Install OpenLLMetry for Next.js by following these 3 easy steps and get instant monitoring."
---

You can also check out our full working example with Next.js 13 [here](https://github.com/traceloop/openllmetry-nextjs-demo).

<Steps>
<Step title="Install the SDK">

Run the following command in your terminal:

<CodeGroup>
```bash npm
npm install @traceloop/node-server-sdk
```

```bash pnpm
pnpm install @traceloop/node-server-sdk
```

```bash yarn
yarn add @traceloop/node-server-sdk
```

</CodeGroup>

Create a file named `instrumentation.ts` in the root of your project (i.e., outside of the `pages` or 'app' directory) and add the following code:

```ts
export async function register() {
  if (process.env.NEXT_RUNTIME === "nodejs") {
    await import("./instrumentation.node.ts");
  }
}
```

Create a file named `instrumentation.node.ts` in the root of your project and add the following code:

```ts
import * as traceloop from "@traceloop/node-server-sdk";
import OpenAI from "openai";

traceloop.initialize({
  appName: "app",
  disableBatch: true,
  instrumentModules: {
    openAI: OpenAI,
    // Add any other modules you'd like to instrument here
  },
});
```

<Warning>
  Make sure to explictly pass any LLM modules you want to instrument as
  otherwise auto-instrumentation won't work on Next.js. Also make sure to set
  `disableBatch` to `true`.
</Warning>

On older versions of Next.js, you'll also need to add the following to your `next.config.js`:

```js
/** @type {import('next').NextConfig} */
const nextConfig = {
  experimental: {
    instrumentationHook: true,
  },
};

module.exports = nextConfig;
```

<Tip>
  See Next.js official OpenTelemetry docs for [app router
  projects](https://nextjs.org/docs/app/building-your-application/optimizing/open-telemetry)
  or [pages router
  projects](https://nextjs.org/docs/pages/building-your-application/optimizing/open-telemetry)
  for more information.
</Tip>

</Step>
<Step title="Annotate your workflows">
<Frame>
  <img src="/img/workflow.png" />
</Frame>
If you have complex workflows or chains, you can annotate them to get a better understanding of what's going on.
You'll see the complete trace of your workflow on Traceloop or any other dashboard you're using.

We have a set of [methods and decorators](/openllmetry/tracing/annotations) to make this easier.
Assume you have a function that renders a prompt and calls an LLM, simply wrap it in a `withWorkflow()` function call.

We also have compatible Typescript decorators for class methods which are more convenient.

<Tip>
  If you're using an LLM framework like Haystack, Langchain or LlamaIndex -
  we'll do that for you. No need to add any annotations to your code.
</Tip>

<CodeGroup>
```js Functions (async / sync)
async function suggestAnswers(question: string) {
  return await withWorkflow({ name: "suggestAnswers" }, () => {
    ...
  });
}
```
```js Class Methods
class MyLLM {
  @traceloop.workflow({ name: "suggest_answers" })
  async suggestAnswers(question: string) {
    ...
  }
}
```
</CodeGroup>

For more information, see the [dedicated section in the docs](/openllmetry/tracing/annotations).

</Step>
<Step title="Configure trace exporting">
Lastly, you'll need to configure where to export your traces.
The 2 environment variables controlling this are `TRACELOOP_API_KEY` and `TRACELOOP_BASE_URL`.

For Traceloop, read on. For other options, see [Exporting](/openllmetry/integrations/introduction).

### Using Traceloop Cloud

Go to [Traceloop](https://app.traceloop.com), and create a new account.
Then, click on **Environments** on the left-hand navigation bar. Or go to directly to https://app.traceloop.com/settings/api-keys.
Click **Generate API Key** to generate an API key for the developement environment and click **Copy API Key** to copy it over.

<Warning>Make sure to copy it as it won't be shown again.</Warning>

<Frame>
  <img src="/img/apikey.png" />
</Frame>

Set the copied Traceloop's API key as an environment variable in your app named `TRACELOOP_API_KEY`.

Done! You'll get instant visibility into everything that's happening with your LLM.
If you're calling a vector DB, or any other external service or database, you'll also see it in the Traceloop dashboard.

</Step>
</Steps>
